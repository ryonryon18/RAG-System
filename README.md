# RAG-System

## 概要
`RAG-System`は、**Retrieval-Augmented Generation (RAG)** システムを構築するためのプロジェクトです。RAGシステムは、生成モデル（例：GPT）と検索エンジン（例：Faiss）を組み合わせ、外部の知識ベースから関連情報を検索して、その情報を基に自然言語の回答を生成する技術です。これにより、従来の生成モデルの限界を超えた、より高精度で豊富な知識に基づいた応答が可能になります。

本プロジェクトでは、**質問応答システム**の実現を目指し、以下の主要な技術を使用しています。

- **OpenAI GPT**: 質問に対する自然な言語生成を行う。
- **Faiss**: 高速なベクトル検索を行うためのライブラリ。
- **Python**: 実装に使用したプログラミング言語。
- **scikit-learn**: 評価指標や誤答分類器の実装。

## 目標

- **Retrieverの性能比較**: Top-k、MMR、Hybrid Retrieverを実装し、各アルゴリズムの検索精度と特性を評価。
- **生成精度の向上**: OpenAIのGPTを活用し、プロンプト設計やパラメータ調整を行って、生成される応答の精度を向上。
- **誤答分析とフィードバックループ**: 生成された誤答を分析し、システムを継続的に改善するための仕組みを構築。

## 使用技術

- **OpenAI GPT**: 質問応答生成のための自然言語処理モデル。主に`text-davinci-003`や`gpt-4`を利用。
- **Faiss**: 高速ベクトル検索のためのライブラリ。文書データの検索を効率的に行うために使用。
- **Flask**: 軽量なWebアプリケーションフレームワークとして、APIサーバーを実装。
- **Python**: プロジェクト全体を通して使用したプログラミング言語。主要ライブラリとして`scikit-learn`や`numpy`などを使用。
- **scikit-learn**: 誤答分類器の構築と評価指標の実装に使用。

## プロジェクト構成

- **data/**: データセット（文書、質問セットなど）
- **models/**: 学習済みモデル、Faissインデックスなど
- **retrievers/**: 検索アルゴリズム（Top-k、MMR、Hybrid）
- **evaluation/**: 評価指標の実装（BLEU、ROUGE、Exact Match）
- **scripts/**: 実行用スクリプト（例: 評価スクリプト、データ処理スクリプト）
- **feedback/**: 誤答分析とフィードバックループの実装

## インストール方法

### 必要なライブラリ
このプロジェクトを実行するためには、以下のライブラリをインストールする必要があります。

```bash
pip install -r requirements.txt
```

### 実行方法

1. リポジトリをクローンします：

```bash
git clone https://github.com/ryonryon18/RAG-System.git
cd RAG-System
```

2. 必要なパッケージをインストールします：

```bash
pip install -r requirements.txt
```

3. `.env` ファイルを作成し、**OpenAI APIキー**を設定します：

```
OPENAI_API_KEY=your-api-key-here
```

4. プロジェクトを開始します：

```bash
python app/app.py  # Flaskサーバーを起動
```

### テスト

プロジェクト内のテストを実行するには、以下のコマンドを使用します：

```bash
python -m unittest discover  # テスト実行
```

## 実装ステップ

### Step 0: 準備
- **プロジェクト構造**の整理：`rag_lab/`ディレクトリ以下にモジュールを分けて整理。
- **データ準備**：元文書（Markdown形式）と質問セット（`questions.json`）を`data/`ディレクトリに配置。
- **APIキー設定**：`.env`ファイルにOpenAI APIキーを設定。

### Step 1: RAG基本構築
- **チャンク分割**（`Step 1-1`）：長文を300トークン（オーバーラップ50）で分割。
- **Embedding生成**（`Step 1-2`）：文書をOpenAI APIを使ってベクトル化。
- **Faissインデックス構築**（`Step 1-3`）：Faissを使ってEmbeddingをインデックス化。
- **Top-k Retriever実装**（`Step 1-4`）：最も類似する文書を検索するためのRetrieverを実装。

### Step 2: Retrieverバリエーション実装
- **MMR Retriever実装**：関連性と多様性を考慮して検索結果を返すMMRアルゴリズムの実装。
- **Hybrid Retriever実装**：BM25とDenseベクトル検索を組み合わせたHybrid Retriever。

### Step 3: 評価パイプライン
- **BLEU, ROUGE, Exact Match (EM)**などの評価指標を使って生成された回答を評価。
- **人手評価**テンプレートを作成し、機械評価の結果と比較。

### Step 4: 誤答分析とフィードバックループ
- **誤答DB**（SQLite）を作成し、誤答データを収集・分析。
- **誤答分類器**を使って誤答を「GOOD」「BAD」に分類。
- **フィードバックループ**を活用し、プロンプトやモデルを改善。

### Step 5: 最適化（LoRA、プロンプトチューニング）
- **LoRA**（Low-Rank Adaptation）を使って、生成モデルのパラメータ最適化。
- **プロンプトチューニング**で生成される応答の精度を向上。

### Step 6: 最終評価と可視化
- 評価結果を集計し、**可視化**（棒グラフやヒートマップ）して各Retrieverの性能を比較。
- **最終レポート**を作成して、プロジェクトの成果をまとめる。

### Step 7: 誤答分析とフィードバックループ強化
- 誤答分析を元に、プロンプト改善や再学習によるモデル精度向上を行う。

## 貢献方法

このプロジェクトはオープンソースで、誰でも貢献できます。貢献するためには以下の手順を行ってください：

1. リポジトリをフォークしてください。
2. 新しいブランチを作成し、変更を加えます。
3. プルリクエストを作成して、変更内容を提案してください。

## ライセンス
MITライセンスのもとで公開されています。
